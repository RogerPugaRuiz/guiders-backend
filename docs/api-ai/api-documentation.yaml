version: "1.0.0"
generated: "2025-09-20T16:30:00.000Z"
baseUrl: "http://localhost:3000"
contexts:
  - name: "visitors-v2"
    description: "Gestión de visitantes V2 optimizada"
    controllers:
      - name: "SitesController"
        context: "visitors-v2"
        baseUrl: "sites"
        description: "Controller para resolución de sitios por host"
        tags:
          - "sites"
        endpoints:
          - method: "POST"
            path: "/sites/resolve"
            summary: "Resolver sitio por host"
            description: "Resuelve el host actual del navegador y determina a qué site y tenant pertenece"
            tags: []
            auth:
              required: false
              bearer: false
            parameters:
              body:
                description: "Datos del host a resolver"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    host:
                      type: "string"
                      description: "Dominio del navegador"
                      example: "landing.mytech.com"
                  required:
                    - "host"
            responses:
              - status: 200
                description: "Sitio resuelto exitosamente"
                schema:
                  type: "object"
                  properties:
                    siteId:
                      type: "string"
                      example: "550e8400-e29b-41d4-a716-446655440000"
                    tenantId:
                      type: "string"
                      example: "550e8400-e29b-41d4-a716-446655440001"
                    siteName:
                      type: "string"
                      example: "Landing Principal"
                    companyName:
                      type: "string"
                      example: "MyTech Solutions"
              - status: 404
                description: "Host no encontrado"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "Host no encontrado"
            examples:
              request:
                host: "landing.mytech.com"
              response:
                siteId: "550e8400-e29b-41d4-a716-446655440000"
                tenantId: "550e8400-e29b-41d4-a716-446655440001"
                siteName: "Landing Principal"
                companyName: "MyTech Solutions"
        filePath: "src/context/visitors-v2/infrastructure/controllers/sites.controller.ts"
      - name: "VisitorV2Controller"
        context: "visitors-v2"
        baseUrl: "visitors"
        description: "Controller para gestión de visitantes V2"
        tags:
          - "visitors"
        endpoints:
          - method: "POST"
            path: "/visitors/identify"
            summary: "Identificar visitante"
            description: "Registra o actualiza un visitante en el sistema usando dominio y API Key"
            tags: []
            auth:
              required: false
              bearer: false
            parameters:
              body:
                description: "Datos del visitante para identificación"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    domain:
                      type: "string"
                      description: "Dominio del sitio web"
                      example: "mytech.com"
                    apiKey:
                      type: "string"
                      description: "API Key del sitio"
                      example: "gd_live_sk_abc123def456"
                    visitorId:
                      type: "string"
                      description: "ID único del visitante (opcional)"
                      example: "visitor_550e8400e29b41d4a716446655440000"
                    email:
                      type: "string"
                      description: "Email del visitante (opcional)"
                      example: "visitante@ejemplo.com"
                    name:
                      type: "string"
                      description: "Nombre del visitante (opcional)"
                      example: "Juan Pérez"
                  required:
                    - "domain"
                    - "apiKey"
            responses:
              - status: 201
                description: "Visitante identificado exitosamente"
                schema:
                  type: "object"
                  properties:
                    visitorId:
                      type: "string"
                      example: "visitor_550e8400e29b41d4a716446655440000"
                    sessionId:
                      type: "string"
                      example: "session_650e8400e29b41d4a716446655440001"
                    siteId:
                      type: "string"
                      example: "550e8400-e29b-41d4-a716-446655440000"
                    tenantId:
                      type: "string"
                      example: "550e8400-e29b-41d4-a716-446655440001"
                    isNewVisitor:
                      type: "boolean"
                      example: true
              - status: 400
                description: "Datos inválidos"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "Domain y apiKey son requeridos"
              - status: 401
                description: "API Key inválida"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "API Key inválida para el dominio especificado"
            examples:
              request:
                domain: "mytech.com"
                apiKey: "gd_live_sk_abc123def456"
                email: "visitante@ejemplo.com"
                name: "Juan Pérez"
              response:
                visitorId: "visitor_550e8400e29b41d4a716446655440000"
                sessionId: "session_650e8400e29b41d4a716446655440001"
                siteId: "550e8400-e29b-41d4-a716-446655440000"
                tenantId: "550e8400-e29b-41d4-a716-446655440001"
                isNewVisitor: true
        filePath: "src/context/visitors-v2/infrastructure/controllers/visitor-v2.controller.ts"

  - name: "conversations-v2"
    description: "Sistema de chat V2 optimizado (MongoDB)"
    controllers:
      - name: "ChatV2Controller"
        context: "conversations-v2"
        baseUrl: "v2/chats"
        description: "Controller para la gestión de chats v2"
        tags:
          - "Chats V2"
        endpoints:
          - method: "POST"
            path: "/v2/chats"
            summary: "Crear nuevo chat"
            description: "Crea un nuevo chat para el visitante autenticado"
            tags: []
            auth:
              required: true
              roles:
                - "visitor"
              bearer: false
            parameters:
              body:
                description: "Datos opcionales para crear el chat"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    department:
                      type: "string"
                      description: "Departamento al que dirigir el chat"
                      example: "ventas"
                    priority:
                      type: "string"
                      enum:
                        - "LOW"
                        - "MEDIUM"
                        - "HIGH"
                        - "URGENT"
                      example: "MEDIUM"
                    subject:
                      type: "string"
                      description: "Asunto del chat"
                      example: "Consulta sobre precios"
            responses:
              - status: 201
                description: "Chat creado exitosamente"
                schema:
                  type: "object"
                  properties:
                    chatId:
                      type: "string"
                      example: "550e8400-e29b-41d4-a716-446655440000"
                    status:
                      type: "string"
                      example: "PENDING"
                    queuePosition:
                      type: "number"
                      example: 3
                    estimatedWaitTime:
                      type: "number"
                      example: 180
            examples:
              request:
                department: "ventas"
                priority: "MEDIUM"
                subject: "Consulta sobre precios"
              response:
                chatId: "550e8400-e29b-41d4-a716-446655440000"
                status: "PENDING"
                queuePosition: 3
                estimatedWaitTime: 180
          - method: "POST"
            path: "/v2/chats/with-message"
            summary: "Crear nuevo chat con primer mensaje"
            description: "Crea un nuevo chat con mensaje inicial de forma atómica"
            tags: []
            auth:
              required: true
              roles:
                - "visitor"
              bearer: false
            parameters:
              body:
                description: "Datos del chat y primer mensaje"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    chat:
                      type: "object"
                      properties:
                        department:
                          type: "string"
                          example: "soporte"
                        priority:
                          type: "string"
                          example: "HIGH"
                        subject:
                          type: "string"
                          example: "Problema técnico urgente"
                    message:
                      type: "object"
                      properties:
                        content:
                          type: "string"
                          example: "Hola, tengo un problema urgente"
                        type:
                          type: "string"
                          enum:
                            - "TEXT"
                            - "IMAGE"
                            - "FILE"
                          example: "TEXT"
                      required:
                        - "content"
                        - "type"
                  required:
                    - "message"
            responses:
              - status: 201
                description: "Chat y mensaje creados exitosamente"
                schema:
                  type: "object"
                  properties:
                    chat:
                      type: "object"
                      properties:
                        chatId:
                          type: "string"
                          example: "550e8400-e29b-41d4-a716-446655440000"
                        status:
                          type: "string"
                          example: "PENDING"
                    message:
                      type: "object"
                      properties:
                        messageId:
                          type: "string"
                          example: "msg_750e8400e29b41d4a716446655440001"
                        content:
                          type: "string"
                          example: "Hola, tengo un problema urgente"
            examples:
              request:
                chat:
                  department: "soporte"
                  priority: "HIGH"
                  subject: "Problema técnico urgente"
                message:
                  content: "Hola, tengo un problema urgente"
                  type: "TEXT"
              response:
                chat:
                  chatId: "550e8400-e29b-41d4-a716-446655440000"
                  status: "PENDING"
                message:
                  messageId: "msg_750e8400e29b41d4a716446655440001"
                  content: "Hola, tengo un problema urgente"
        filePath: "src/context/conversations-v2/infrastructure/controllers/chat-v2.controller.ts"
      - name: "MessageV2Controller"
        context: "conversations-v2"
        baseUrl: "v2/messages"
        description: "Controller para la gestión de mensajes v2"
        tags:
          - "Messages V2"
        endpoints:
          - method: "POST"
            path: "/v2/messages"
            summary: "Enviar un nuevo mensaje"
            description: "Envía un mensaje de texto, imagen o archivo a un chat específico"
            tags: []
            auth:
              required: true
              roles:
                - "commercial"
                - "visitor"
              bearer: false
            parameters:
              body:
                description: "Datos del mensaje a enviar"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    chatId:
                      type: "string"
                      description: "ID del chat"
                      example: "550e8400-e29b-41d4-a716-446655440000"
                    content:
                      type: "string"
                      description: "Contenido del mensaje"
                      example: "Hola, ¿en qué puedo ayudarte?"
                    type:
                      type: "string"
                      enum:
                        - "TEXT"
                        - "IMAGE"
                        - "FILE"
                        - "SYSTEM"
                      example: "TEXT"
                  required:
                    - "chatId"
                    - "content"
                    - "type"
            responses:
              - status: 201
                description: "Mensaje enviado exitosamente"
                schema:
                  type: "object"
                  properties:
                    messageId:
                      type: "string"
                      example: "msg_750e8400e29b41d4a716446655440001"
                    chatId:
                      type: "string"
                      example: "550e8400-e29b-41d4-a716-446655440000"
                    senderId:
                      type: "string"
                      example: "user_850e8400e29b41d4a716446655440002"
                    senderType:
                      type: "string"
                      example: "COMMERCIAL"
                    content:
                      type: "string"
                      example: "Hola, ¿en qué puedo ayudarte?"
                    sentAt:
                      type: "string"
                      format: "date-time"
                      example: "2025-09-20T10:35:00Z"
                    status:
                      type: "string"
                      example: "SENT"
              - status: 400
                description: "Datos inválidos"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "El contenido del mensaje es requerido"
              - status: 404
                description: "Chat no encontrado"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "Chat no encontrado"
            examples:
              request:
                chatId: "550e8400-e29b-41d4-a716-446655440000"
                content: "Hola, ¿en qué puedo ayudarte?"
                type: "TEXT"
              response:
                messageId: "msg_750e8400e29b41d4a716446655440001"
                chatId: "550e8400-e29b-41d4-a716-446655440000"
                senderId: "user_850e8400e29b41d4a716446655440002"
                senderType: "COMMERCIAL"
                content: "Hola, ¿en qué puedo ayudarte?"
                sentAt: "2025-09-20T10:35:00Z"
                status: "SENT"
        filePath: "src/context/conversations-v2/infrastructure/controllers/message-v2.controller.ts"

  - name: "auth"
    description: "Autenticación y autorización de usuarios"
    controllers:
      - name: "AuthUserController"
        context: "auth"
        baseUrl: "user/auth"
        description: "Controller para autenticación de usuarios"
        tags:
          - "Autenticación de Usuarios"
        endpoints:
          - method: "POST"
            path: "/user/auth/login"
            summary: "Iniciar sesión de usuario"
            description: "Verifica las credenciales y devuelve tokens de acceso"
            tags: []
            auth:
              required: false
              bearer: false
            parameters:
              body:
                description: "Credenciales de login"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    email:
                      type: "string"
                      format: "email"
                      description: "Email del usuario"
                      example: "admin@mytech.com"
                    password:
                      type: "string"
                      description: "Contraseña del usuario"
                      example: "SecurePassword123!"
                  required:
                    - "email"
                    - "password"
            responses:
              - status: 200
                description: "Login exitoso"
                schema:
                  type: "object"
                  properties:
                    accessToken:
                      type: "string"
                      example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    refreshToken:
                      type: "string"
                      example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    user:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                          example: "user_550e8400e29b41d4a716446655440000"
                        email:
                          type: "string"
                          example: "admin@mytech.com"
                        name:
                          type: "string"
                          example: "Admin Usuario"
                        role:
                          type: "string"
                          example: "admin"
                        companyId:
                          type: "string"
                          example: "company_650e8400e29b41d4a716446655440001"
                    expiresIn:
                      type: "number"
                      example: 3600
              - status: 401
                description: "Credenciales inválidas"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "Email o contraseña incorrectos"
            examples:
              request:
                email: "admin@mytech.com"
                password: "SecurePassword123!"
              response:
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                user:
                  id: "user_550e8400e29b41d4a716446655440000"
                  email: "admin@mytech.com"
                  name: "Admin Usuario"
                  role: "admin"
                  companyId: "company_650e8400e29b41d4a716446655440001"
                expiresIn: 3600
          - method: "GET"
            path: "/user/auth/me"
            summary: "Obtener usuario autenticado"
            description: "Devuelve la información del usuario autenticado"
            tags: []
            auth:
              required: true
              roles:
                - "admin"
                - "commercial"
              bearer: true
            parameters: {}
            responses:
              - status: 200
                description: "Información del usuario autenticado"
                schema:
                  type: "object"
                  properties:
                    user:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                          example: "user_550e8400e29b41d4a716446655440000"
                        email:
                          type: "string"
                          example: "admin@mytech.com"
                        name:
                          type: "string"
                          example: "Admin Usuario"
                        role:
                          type: "string"
                          example: "admin"
                        companyId:
                          type: "string"
                          example: "company_650e8400e29b41d4a716446655440001"
                        company:
                          type: "object"
                          properties:
                            name:
                              type: "string"
                              example: "MyTech Solutions"
                            domain:
                              type: "string"
                              example: "mytech.com"
                        permissions:
                          type: "array"
                          items:
                            type: "string"
                          example:
                            - "MANAGE_USERS"
                            - "VIEW_ANALYTICS"
                            - "MANAGE_CHATS"
                        status:
                          type: "string"
                          example: "ACTIVE"
              - status: 401
                description: "Token inválido o expirado"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "Token inválido"
            examples:
              response:
                user:
                  id: "user_550e8400e29b41d4a716446655440000"
                  email: "admin@mytech.com"
                  name: "Admin Usuario"
                  role: "admin"
                  companyId: "company_650e8400e29b41d4a716446655440001"
                  company:
                    name: "MyTech Solutions"
                    domain: "mytech.com"
                  permissions:
                    - "MANAGE_USERS"
                    - "VIEW_ANALYTICS"
                    - "MANAGE_CHATS"
                  status: "ACTIVE"
        filePath: "src/context/auth/auth-user/infrastructure/controllers/auth-user.controller.ts"

  - name: "company"
    description: "Gestión de empresas y sitios web"
    controllers:
      - name: "CompanyController"
        context: "company"
        baseUrl: ""
        description: "Controller para gestión de empresas"
        tags:
          - "companies"
        endpoints:
          - method: "POST"
            path: "/company"
            summary: "Crear nueva empresa con administrador"
            description: "Crea una nueva empresa junto con su usuario administrador inicial"
            tags: []
            auth:
              required: false
              bearer: false
            parameters:
              body:
                description: "Datos de la nueva empresa y administrador"
                type: "object"
                required: true
                schema:
                  type: "object"
                  properties:
                    company:
                      type: "object"
                      properties:
                        name:
                          type: "string"
                          example: "TechStart Solutions"
                        domain:
                          type: "string"
                          example: "techstart.com"
                        industry:
                          type: "string"
                          example: "Tecnología"
                        size:
                          type: "string"
                          enum:
                            - "SMALL"
                            - "MEDIUM"
                            - "LARGE"
                            - "ENTERPRISE"
                          example: "MEDIUM"
                      required:
                        - "name"
                        - "domain"
                    admin:
                      type: "object"
                      properties:
                        name:
                          type: "string"
                          example: "Carlos Administrador"
                        email:
                          type: "string"
                          format: "email"
                          example: "admin@techstart.com"
                        password:
                          type: "string"
                          example: "SecurePassword123!"
                      required:
                        - "name"
                        - "email"
                        - "password"
                  required:
                    - "company"
                    - "admin"
            responses:
              - status: 201
                description: "Empresa creada exitosamente"
                schema:
                  type: "object"
                  properties:
                    company:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                          example: "company_550e8400e29b41d4a716446655440000"
                        name:
                          type: "string"
                          example: "TechStart Solutions"
                        domain:
                          type: "string"
                          example: "techstart.com"
                    admin:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                          example: "user_650e8400e29b41d4a716446655440001"
                        email:
                          type: "string"
                          example: "admin@techstart.com"
                    apiKey:
                      type: "string"
                      description: "API Key generada para la empresa"
                      example: "gd_live_sk_abc123def456ghi789"
              - status: 400
                description: "Datos inválidos"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "El dominio ya está en uso"
            examples:
              request:
                company:
                  name: "TechStart Solutions"
                  domain: "techstart.com"
                  industry: "Tecnología"
                  size: "MEDIUM"
                admin:
                  name: "Carlos Administrador"
                  email: "admin@techstart.com"
                  password: "SecurePassword123!"
              response:
                company:
                  id: "company_550e8400e29b41d4a716446655440000"
                  name: "TechStart Solutions"
                  domain: "techstart.com"
                admin:
                  id: "user_650e8400e29b41d4a716446655440001"
                  email: "admin@techstart.com"
                apiKey: "gd_live_sk_abc123def456ghi789"
        filePath: "src/context/company/infrastructure/controllers/company.controller.ts"

  - name: "tracking"
    description: "Seguimiento de intenciones y métricas"
    controllers:
      - name: "VisitorIntentController"
        context: "tracking"
        baseUrl: "tracking/intent"
        description: "Controller para seguimiento de intenciones"
        tags: []
        endpoints:
          - method: "GET"
            path: "/tracking/intent/:visitorId"
            summary: "Obtener intenciones del visitante"
            description: "Retorna las intenciones de compra y comportamiento registradas"
            tags: []
            auth:
              required: true
              roles:
                - "commercial"
                - "admin"
              bearer: true
            parameters:
              path:
                - name: "visitorId"
                  description: "ID único del visitante"
                  example: "visitor_550e8400e29b41d4a716446655440000"
                  required: true
            responses:
              - status: 200
                description: "Intenciones obtenidas exitosamente"
                schema:
                  type: "object"
                  properties:
                    visitorId:
                      type: "string"
                      example: "visitor_550e8400e29b41d4a716446655440000"
                    intents:
                      type: "array"
                      items:
                        type: "object"
                        properties:
                          type:
                            type: "string"
                            enum:
                              - "PURCHASE"
                              - "INQUIRY"
                              - "SUPPORT"
                              - "BROWSING"
                            example: "PURCHASE"
                          confidence:
                            type: "number"
                            minimum: 0
                            maximum: 1
                            example: 0.85
                          category:
                            type: "string"
                            example: "product-pricing"
                          value:
                            type: "string"
                            example: "Interesado en plan premium"
                          detectedAt:
                            type: "string"
                            format: "date-time"
                            example: "2025-09-20T10:15:00Z"
                    summary:
                      type: "object"
                      properties:
                        totalIntents:
                          type: "number"
                          example: 5
                        highestConfidence:
                          type: "number"
                          example: 0.92
                        dominantCategory:
                          type: "string"
                          example: "product-pricing"
              - status: 404
                description: "Visitante no encontrado"
                schema:
                  type: "object"
                  properties:
                    error:
                      type: "string"
                      example: "Visitante no encontrado"
            examples:
              response:
                visitorId: "visitor_550e8400e29b41d4a716446655440000"
                intents:
                  - type: "PURCHASE"
                    confidence: 0.85
                    category: "product-pricing"
                    value: "Interesado en plan premium"
                    detectedAt: "2025-09-20T10:15:00Z"
                summary:
                  totalIntents: 5
                  highestConfidence: 0.92
                  dominantCategory: "product-pricing"
        filePath: "src/context/tracking/infrastructure/controllers/visitor-intent.controller.ts"

summary:
  totalEndpoints: 52
  totalControllers: 10
  authenticationMethods:
    - "Bearer JWT"
    - "OIDC"
  availableRoles:
    - "admin"
    - "commercial"
    - "visitor"